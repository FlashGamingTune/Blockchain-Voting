<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Election Results</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
  --bg:#0b0f19;
  --panel:#121726;
  --panel-soft:#171c2f;
  --text:#f5f7fb;
  --muted:#aab0c0;
  --accent:#7c8cff;
  --winner:#22c55e;
  --radius:18px;
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  min-height:100vh;
  padding:40px;
  font-family:system-ui;
  background:
    radial-gradient(900px 500px at 20% 10%,#1b255a,transparent),
    radial-gradient(800px 400px at 90% 90%,#3b1d5a,transparent),
    var(--bg);
  color:var(--text);
}

/* NAV */
.nav{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:35px;
}

.nav h1{font-size:1.8rem}

.nav a{
  text-decoration:none;
  padding:10px 14px;
  border-radius:12px;
  font-size:.85rem;
  color:var(--muted);
  background:rgba(255,255,255,.06);
}

.nav a:hover{background:rgba(124,140,255,.18);color:white}

/* LAYOUT */
.dashboard{
  display:grid;
  grid-template-columns:1fr 420px;
  gap:32px;
}

.panel{
  background:linear-gradient(180deg,var(--panel),var(--panel-soft));
  border-radius:var(--radius);
  padding:28px;
}

/* WINNER BADGE */
.winner-badge{
  display:inline-flex;
  gap:8px;
  padding:8px 14px;
  border-radius:999px;
  background:linear-gradient(90deg,#22c55e,#16a34a);
  font-weight:600;
  margin-bottom:16px;
}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  padding:14px 8px;
  border-bottom:1px solid rgba(255,255,255,.08);
}

th{color:var(--muted);font-weight:500}

tr.winner{
  background:linear-gradient(90deg,rgba(34,197,94,.2),transparent);
}

/* ANIMATED VOTES */
.vote{
  font-weight:600;
}

/* CHART */
canvas{
  width:260px!important;
  height:260px!important;
  margin:auto;
}

/* CONFETTI */
.confetti{
  position:fixed;
  width:6px;
  height:10px;
  background:#22c55e;
  top:-10px;
  animation:fall 3s linear forwards;
}

@keyframes fall{
  to{
    transform:translateY(100vh) rotate(360deg);
    opacity:0;
  }
}

@media(max-width:900px){
  .dashboard{grid-template-columns:1fr}
}
</style>
</head>

<body>

<div class="nav">
  <h1>Election Results</h1>
  <div>
    <a href="/admin/candidates">Manage Candidates</a>
    <a href="/admin/verify">Verify Blockchain</a>
    <a href="/logout">Logout</a>
  </div>
</div>

<div class="dashboard">

<!-- RESULTS PANEL -->
<div class="panel">

{% if results %}
<div class="winner-badge">üèÜ Winner: {{ results[0].name }}</div>
{% endif %}

<table>
<tr>
  <th>Candidate</th>
  <th>Party</th>
  <th>Votes</th>
</tr>

{% for row in results %}
<tr class="{% if loop.first %}winner{% endif %}">
  <td>{{ row.name }}</td>
  <td>{{ row.party }}</td>
  <td class="vote" data-votes="{{ row.votes }}">0</td>
</tr>
{% endfor %}
</table>

</div>

<!-- CHART PANEL -->
<div class="panel">
  <canvas id="voteChart"></canvas>
</div>

</div>

<script>
/* -------- ANIMATED COUNTER -------- */
document.querySelectorAll(".vote").forEach(el=>{
  const target = +el.dataset.votes;
  let count = 0;
  const step = Math.max(1, Math.floor(target/30));

  const interval = setInterval(()=>{
    count += step;
    if(count >= target){
      el.textContent = target;
      clearInterval(interval);
    }else{
      el.textContent = count;
    }
  },30);
});

/* -------- CONFETTI FOR WINNER -------- */
for(let i=0;i<20;i++){
  const confetti = document.createElement("div");
  confetti.className="confetti";
  confetti.style.left=Math.random()*100+"vw";
  confetti.style.background=["#22c55e","#7c8cff","#f59e0b"][Math.floor(Math.random()*3)];
  document.body.appendChild(confetti);
  setTimeout(()=>confetti.remove(),3000);
}

/* -------- PIE CHART -------- */
const labels={{ results | map(attribute='name') | list | safe }};
const votes={{ results | map(attribute='votes') | list | safe }};

new Chart(document.getElementById("voteChart"),{
  type:"pie",
  data:{
    labels:labels,
    datasets:[{
      data:votes,
      backgroundColor:["#22c55e","#7c8cff","#f59e0b","#ef4444"]
    }]
  },
  options:{
    responsive:false,
    plugins:{
      legend:{position:"bottom",labels:{color:"#f5f7fb"}}
    }
  }
});
</script>

</body>
</html>
